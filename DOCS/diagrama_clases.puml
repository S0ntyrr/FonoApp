@startuml FonoApp - Diagrama de Clases

' Configuración y Base de Datos
class AppSettings {
  + MONGODB_URI: str
  + MONGODB_DB_NAME: str
  + Config
}

class database {
  + mongo_client: AsyncIOMotorClient
  + connect_to_mongo()
  + close_mongo_connection()
  + get_db()
}

' Modelos Pydantic
class UsuarioBase {
  + nombre: str
  + email: EmailStr
  + activo: bool
  + rol: str
  + estado: str
}

note right of UsuarioBase
  Roles disponibles:
  - admin
  - medico (doctor)
  - paciente
  - emisor
  
  Estados disponibles:
  - activo
  - ocupado
  - consulta
end note

class UsuarioCreate {
  + password: str
  + acepta_terminos: bool
}

class UsuarioPublico {
  + id: str
}

class ActividadCategoria {
  + id: str
  + categoria: str
  + actividades: List[str]
}

class Asignacion {
  + id: str
  + paciente_email: EmailStr
  + medico_email: EmailStr
  + actividades_asignadas: list[dict]
  + dificultad: str
  + fecha_asignacion: datetime
  + estado: str
}

note right of Asignacion
  Estados:
  - pendiente
  - aceptada
  - cancelada
end note

class ContenidoAdmin {
  + id: str
  + imagenes: List[str]
  + videos: List[str]
  + audios_referencia: List[str]
  + textos_sistema: List[str]
  + instrucciones: Any
}

class HistorialActividad {
  + id: str
  + paciente_email: EmailStr
  + categoria: str
  + actividad: str
  + puntos_obtenidos: int
  + nivel: int
  + fecha: datetime
  + feedback: str
}

class PerfilPaciente {
  + id: str
  + paciente_email: EmailStr
  + nombre: str
  + edad: int
  + escolaridad: str
  + genero: str
  + fecha_registro: datetime
  + tutor: str
  + parentesco: str
}

class SesionApp {
  + id: str
  + paciente_email: EmailStr
  + fecha: datetime
  + minutos_conectado: int
}

class ResultadoJuego {
  + id: str
  + paciente_email: EmailStr
  + categoria: str
  + juego: str
  + paso_completado: int
  + total_pasos: int
  + completado: bool
  + fecha: datetime
  + notas: str
}

note right of ResultadoJuego
  Categorías de juegos:
  - articulacion
  - resonancia
  - respiracion
  - fonacion
  - practica
end note

' Routers activos (registrados en main.py)
class AuthRouter {
  + prefix: "/auth"
  + mostrar_pantalla_login() GET
  + mostrar_pantalla_registro() GET
  + procesar_registro() POST
  + procesar_login() POST
}

class PacienteRouter {
  + prefix: "/paciente"
  + vista_perfil_paciente() GET
  + guardar_perfil_paciente() POST
}

class EmisorRouter {
  + prefix: "/emisor"
  + home_emisor() GET
}

class RoutesAdmin {
  + prefix: "/admin"
  + vista_dashboard_admin() GET
  + listar_pacientes_admin() GET
  + crear_paciente_admin() POST
  + eliminar_paciente_admin() POST
  + listar_medicos_admin() GET
  + crear_medico_admin() POST
  + eliminar_medico_admin() POST
  + cambiar_estado_medico_admin() POST
  + editar_medico_form_admin() GET
  + editar_medico_admin() POST
  + ver_consultas_medico_admin() GET
  + vista_actividades_admin() GET
  + vista_contenido_admin() GET
  + vista_asignaciones_admin() GET
  + vista_historial_admin() GET
  + vista_resultados_admin() GET
}

class RoutesDoctor {
  + prefix: "/doctor"
  + home_doctor() GET
  + vista_pacientes_doctor() GET
  + vista_actividades_doctor() GET
  + vista_asignaciones_doctor() GET
  + aceptar_asignacion() POST
  + cancelar_asignacion() POST
  + vista_historial_doctor() GET
  + vista_resultados_doctor() GET
  + vista_evaluaciones_pendientes() GET
  + cambiar_estado_doctor() POST
}

class RoutesJuegos {
  + prefix: "/juegos"
  + hub_juegos() GET
  + juego_practica() GET
  + juego_rompecabezas() GET
  + juego_cara() GET
  + juego_asociacion() GET
  + juego_respiracion() GET
  + juego_globo() GET
  + juego_molino() GET
  + juego_fonacion() GET
  + juego_gol() GET
  + juego_escala() GET
  + juego_resonancia() GET
  + juego_escaleras() GET
  + juego_piano() GET
  + juego_veoveo() GET
  + juego_articulacion() GET
  + articulacion_letra_b() GET
  + articulacion_letra_d() GET
  + articulacion_letra_f() GET
  + articulacion_letra_r() GET
  + guardar_resultado_juego() POST
}

' Aplicación Principal
class FastAPIApp {
  + title: "FonoApp"
  + version: "1.0.0"
  + lifespan()
  + raiz() GET "/"
}

' Relaciones de Herencia
UsuarioCreate --|> UsuarioBase
UsuarioPublico --|> UsuarioBase

' Relaciones de Dependencia
database ..> AppSettings : usa
AuthRouter ..> database : usa
PacienteRouter ..> database : usa
PacienteRouter ..> PerfilPaciente : usa
PacienteRouter ..> SesionApp : usa
RoutesDoctor ..> database : usa
RoutesDoctor ..> ActividadCategoria : usa
RoutesDoctor ..> Asignacion : usa
RoutesDoctor ..> HistorialActividad : usa
RoutesAdmin ..> database : usa
RoutesAdmin ..> ActividadCategoria : usa
RoutesAdmin ..> ContenidoAdmin : usa
RoutesAdmin ..> Asignacion : usa
RoutesAdmin ..> HistorialActividad : usa
RoutesJuegos ..> database : usa
RoutesJuegos ..> ResultadoJuego : usa
FastAPIApp ..> database : usa
FastAPIApp ..> AuthRouter : incluye
FastAPIApp ..> PacienteRouter : incluye
FastAPIApp ..> EmisorRouter : incluye
FastAPIApp ..> RoutesAdmin : incluye
FastAPIApp ..> RoutesDoctor : incluye
FastAPIApp ..> RoutesJuegos : incluye

' Relaciones con Base de Datos
Asignacion ..> UsuarioBase : referencia
HistorialActividad ..> UsuarioBase : referencia
PerfilPaciente ..> UsuarioBase : referencia
SesionApp ..> UsuarioBase : referencia
ResultadoJuego ..> UsuarioBase : referencia

note right of HistorialActividad
  Registra las actividades
  completadas por pacientes.
  feedback=null indica
  evaluación pendiente
end note

note right of database
  Maneja la conexión
  a MongoDB usando Motor
  (async)
end note

@enduml
