<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
  <title>{{ titulo_pagina }}</title>
  <link rel="stylesheet" href="/static/css/estilos.css">
  <script>
  function guardarResultadoJuego(cat,juego,paso,total,completado,puntos=0,nivel=1){
    const email=sessionStorage.getItem("paciente_email")||localStorage.getItem("paciente_email_actual")||"paciente@tesis.com";
    const fd=new FormData();fd.append('paciente_email',email);fd.append('categoria',cat);
    fd.append('juego',juego);fd.append('paso_completado',paso);fd.append('total_pasos',total);
    fd.append('completado',completado);fd.append('puntos',puntos);fd.append('nivel',nivel);
    fetch('/juegos/resultado',{method:'POST',body:fd}).catch(e=>console.warn(e));
  }
  </script>
  <style>
    /* mobile container */
    body { margin:0; background:#fff; font-family: 'Segoe UI', sans-serif; }
    .screen { max-width:430px; margin:0 auto; min-height:100vh; padding:16px; box-sizing:border-box; }
    h1.cat-title { color:#e63946; text-align:center; font-size:1.4rem; border-bottom:2px solid #e63946; padding-bottom:8px; }
    /* Phase 1 */
    .target-box { text-align:center; margin:12px 0; }
    .target-img { font-size:3rem; }
    .grid { display:flex; flex-wrap:wrap; gap:12px; justify-content:center; margin-top:12px; }
    .grid-item { font-size:2.2rem; cursor:pointer; padding:6px; border-radius:8px; transition:background .2s; }
    .grid-item:hover { background:#ffeaea; }
    .grid-item.correct { background:#c8f7c5; border:2px solid #27ae60; }
    /* Phase 2 */
    .phase2 { display:none; text-align:center; }
    .phase2.active { display:block; }
    .phase1.hidden { display:none; }
    .word-label { font-size:2rem; font-weight:bold; color:#e63946; margin:16px 0; }
    .mic-btn { background:#e63946; color:#fff; border:none; border-radius:50%; width:60px; height:60px; font-size:1.8rem; cursor:pointer; margin:12px auto; display:block; }
    .feedback { color:#27ae60; font-size:1.3rem; font-weight:bold; margin-top:12px; display:none; }
  </style>
</head>
<body>
<div class="screen">
  <h1 class="cat-title">Resonancia</h1>

  <!-- PHASE 1 -->
  <div class="phase1" id="phase1">
    <h2 style="text-align:center;">Â¡Veo, veo!</h2>
    <p>Encuentra la imagen que se muestra.</p>
    <div class="target-box">
      <div class="target-img">ğŸª†</div>
    </div>
    <div class="grid" id="grid">
      <!-- items injected by JS -->
    </div>
  </div>

  <!-- PHASE 2 -->
  <div class="phase2" id="phase2">
    <h2 style="color:#e63946;">Muy bien</h2>
    <p>Â¿cÃ³mo se llama?</p>
    <button class="mic-btn" id="mic1" title="Grabar">ğŸ¤</button>
    <p>Vamos, repite conmigo.<br>Es una:</p>
    <div class="word-label">MUÃ‘ECA</div>
    <div style="font-size:4rem;">ğŸª†</div>
    <button class="mic-btn" id="mic2" title="Grabar">ğŸ¤</button>
    <div class="feedback" id="feedback">Â¡Muy bien! ğŸ‰</div>
    <div style="margin-top:24px;">
      <a href="/juegos/resonancia" style="display:block;text-align:center;color:#e63946;" onclick="guardarResultadoJuego('resonancia','veoveo',2,2,true,50,1);">â† Volver a Resonancia</a>
    </div>
  </div>
</div>

<script>
const items = ['ğŸ”ï¸','ğŸ€','ğŸ ','â˜€ï¸','ğŸ•·ï¸','ğŸŒ¸','ğŸŒ³','ğŸ‘¦','ğŸ©','â˜‚ï¸','ğŸŒˆ','ğŸ­','ğŸ','ğŸª†','ğŸŒº'];
const target = 'ğŸª†';
const grid = document.getElementById('grid');

// Shuffle
items.sort(() => Math.random() - 0.5);
items.forEach(em => {
  const div = document.createElement('div');
  div.className = 'grid-item';
  div.textContent = em;
  div.addEventListener('click', () => {
    if (em === target) {
      div.classList.add('correct');
      setTimeout(() => {
        document.getElementById('phase1').classList.add('hidden');
        document.getElementById('phase2').classList.add('active');
      }, 600);
    } else {
      div.style.background = '#ffd6d6';
      setTimeout(() => div.style.background = '', 500);
    }
  });
  grid.appendChild(div);
});

// Mic buttons (simulate recording)
let recording = false;
function toggleMic(btn) {
  if (!recording) {
    recording = true;
    btn.textContent = 'â¹ï¸';
    btn.style.background = '#27ae60';
    setTimeout(() => {
      recording = false;
      btn.textContent = 'ğŸ¤';
      btn.style.background = '#e63946';
      document.getElementById('feedback').style.display = 'block';
    }, 2000);
  }
}
document.getElementById('mic1').addEventListener('click', () => toggleMic(document.getElementById('mic1')));
document.getElementById('mic2').addEventListener('click', () => toggleMic(document.getElementById('mic2')));
</script>
</body>
</html>
