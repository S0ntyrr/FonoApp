{% extends "base.html" %}

{% block contenido %}
<section class="pantalla-movil">
    <h1 class="titulo-rojo centrado">Gestión de Médicos</h1>

    <h2 class="centrado">Crear nuevo médico</h2>
    <form method="post" action="/admin/medicos/crear" class="formulario-movil">
        <label class="etiqueta-campo" for="nombre">Nombre</label>
        <input type="text" id="nombre" name="nombre" class="campo-texto" required />

        <label class="etiqueta-campo" for="email">Correo</label>
        <input type="email" id="email" name="email" class="campo-texto" required />

        <label class="etiqueta-campo" for="password">Contraseña</label>
        <input type="password" id="password" name="password" class="campo-texto" required />

        <button type="submit" class="boton-rojo ancho-completo">Crear médico</button>
    </form>

    <h2 class="centrado" style="margin-top: 1.5rem;">Filtro por estado</h2>
    <form method="get" action="/admin/medicos" class="formulario-movil">
        <label class="etiqueta-campo" for="estado">Estado</label>
        <select id="estado" name="estado" class="campo-texto">
            <option value="todos" {% if estado_seleccionado == "todos" %}selected{% endif %}>Todos</option>
            <option value="activo" {% if estado_seleccionado == "activo" %}selected{% endif %}>Activos</option>
            <option value="ocupado" {% if estado_seleccionado == "ocupado" %}selected{% endif %}>Ocupados</option>
            <option value="consulta" {% if estado_seleccionado == "consulta" %}selected{% endif %}>En consulta</option>
        </select>

        <button type="submit" class="boton-rojo ancho-completo">
            Aplicar filtro
        </button>
    </form>

    <h2 class="centrado" style="margin-top: 1.5rem;">Listado de médicos</h2>

    {% if medicos %}
        <ul class="lista-pacientes">
            {% for m in medicos %}
                <li class="item-paciente">
                    <div>
                        <strong>{{ m.nombre }}</strong><br />
                        <small>{{ m.email }}</small><br />
                        <small>Estado: {{ m.estado or "activo" }}</small><br />
                        <small>Tiempo en servicio: {{ m.tiempo_servicio }} días</small>
                    </div>
                    <div style="display: flex; flex-direction: column; gap: 0.5rem; align-items: flex-start;">
                        <form method="post" action="/admin/medicos/{{ m._id }}/cambiar_estado" style="display: flex; gap: 0.5rem;">
                            <select name="estado" class="campo-texto" style="flex: 1;">
                                <option value="activo" {% if m.estado == "activo" %}selected{% endif %}>Activo</option>
                                <option value="ocupado" {% if m.estado == "ocupado" %}selected{% endif %}>Ocupado</option>
                                <option value="consulta" {% if m.estado == "consulta" %}selected{% endif %}>En consulta</option>
                            </select>
                            <button type="submit" class="boton-rojo">Cambiar Estado</button>
                        </form>
                        <div style="display: flex; gap: 0.5rem;">
                            <button type="button" class="boton-rojo" onclick="window.location.href='/admin/medicos/{{ m._id }}/editar'">Editar</button>
                            <button type="button" class="boton-rojo" onclick="window.location.href='/admin/medicos/{{ m._id }}/consultas'">Ver Consultas</button>
                            <form method="post" action="/admin/medicos/{{ m._id }}/eliminar" onsubmit="return confirm('¿Eliminar este médico?');" style="display: inline;">
                                <button type="submit" class="boton-rojo-borde">Eliminar</button>
                            </form>
                        </div>
                    </div>
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <p class="centrado">No hay médicos con ese filtro.</p>
    {% endif %}

    <div class="texto-inferior">
        <button type="button" class="boton-enlace-rojo"
                onclick="window.location.href='/admin/dashboard'">
            Volver al panel
        </button>
    </div>
</section>
{% endblock %}


